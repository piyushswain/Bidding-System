 <html>  
    <head>
      <title> Bidding </title>
    </head>
    <body>
        <div id="Bids">
            <h1> Item 1 : </h1>
            <p id="bid_val"></p>
        </div>

        <div id="New_Bids">
            <form id="send">
                <a>Next Bid :</a><p id="new_bid"></p>
                <input type="submit" id ="button" value="Send">
                <p id="time"></p>
            </form>
        </div>

        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

        <script src="/socket.io/socket.io.js"></script>

        <script>
            var client_id;
            var socket = io.connect('http://localhost:3000');
            var timer;
            var time;
            var clockFlag = false;

            if(clockFlag == false)
                $('#time').text('Bidding has not Started');

            function bidClock(){
                timer = setInterval(function(){
                          showTime()} , 1000);
                }

            function showTime(){
                if(time > 0){
                    $('#time').text(time + " seconds left")
                    time -= 1;
                }
            }

            socket.on('connect', function(data) {
                socket.emit('join', "Connected to Server");
            });

            socket.on('assign', function(data){
                client_id = data;
            });

            socket.on('initiate', function(data){
                $("#bid_val").text( data.old );
                $("#new_bid").text( data.new );
                time = data.time;
                if(data.flag === true && clockFlag === false)
                    bidClock();
            });


            socket.on('update', function(data) {
                $("#bid_val").text( data.old );
                $("#new_bid").text( data.new );
                time = data.time;
                if(data.flag === true && clockFlag === false)
                    bidClock();
            });

            socket.on('end', function(data){
                if(client_id == data)
                    window.alert('Bidding Ended\nCongrats You Won The Bidding');
                else
                    window.alert('Bidding Ended\nSorry You Lost The Bidding');
                
                clearInterval(timer);
            })    

            $('#send').submit(function() {
                var new_bid = Number(document.getElementById("new_bid").innerHTML);
                $('#new_bid').val('');
                socket.emit('bid', {bid:new_bid, c_id:client_id});
                return false;
            });
        </script>  
    </body>
 </html>  
